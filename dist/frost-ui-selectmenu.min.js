!function(t,e){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e:e(t)}(window,(function(t){"use strict";if(!t)throw new Error("FrostUI-SelectMenu requires a Window.");if(!("UI"in t))throw new Error("FrostUI-SelectMenu requires FrostUI.");const e=t.Core,s=t.dom,i=t.QuerySet,n=t.UI,a=t.document;class r{constructor(t,i){let n;this._node=t,this._settings=e.extend({},this.constructor.defaults,s.getDataset(this._node),i),this._multiple=s.getProperty(this._node,"multiple"),this._disabled=s.getProperty(this._node,"disabled"),this._getData=null,this._settings.data?e.isPlainObject(this._settings.data)?n=this.constructor._getDataFromObject(this._settings.data):e.isArray(this._settings.data)?n=this._settings.data:e.isFunction(this._settings.data)&&(this._getData=(t,e)=>{this._settings.data(e,e=>{this.constructor._parseData(e.results),t(e)})}):n=this.constructor._getDataFromDOM(this._node),n&&(this._data=this.constructor._parseData(n),this._getData=(t,{term:e=null})=>{let s=this._data;e&&(s=this._settings.sortResults(s.reduce((t,e)=>(e.children?t.push(...e.children):t.push(e),t),[]),e).filter(t=>this._settings.isMatch(t,e))),t({results:s})});const a=s.getValue(this._node);this._render(),this.setValue(a),this._events(),s.setData(this._node,"selectmenu",this)}destroy(){this._popper&&this._popper.destroy(),s.removeData(this._node,"selectmenu")}hide(){!this._settings.inline&&!this._animating&&s.isConnected(this._menuNode)&&s.triggerOne(this._node,"hide.frost.selectmenu")&&(this._animating=!0,s.fadeOut(this._menuNode,{duration:this._settings.duration}).then(t=>{s.empty(this._itemsList),s.detach(this._menuNode),s.detach(this._searchInput),s.setAttribute(this._toggle,"aria-expanded",!1),s.triggerEvent(this._node,"hidden.frost.selectmenu")}).catch(t=>{}).finally(t=>{this._animating=!1}))}show(){this._settings.inline||this._animating||s.isConnected(this._menuNode)||s.is(this._node,":disabled")||!s.triggerOne(this._node,"show.frost.selectmenu")||(this._animating=!0,s.append(a.body,this._menuNode),this._popper.update(),this._getData(t=>{this._renderResults(t.results)},{}),s.fadeIn(this._menuNode,{duration:this._settings.duration}).then(t=>{s.setAttribute(this._toggle,"aria-expanded",!0),s.triggerEvent(this._node,"shown.frost.selectmenu")}).catch(t=>{}).finally(t=>{this._animating=!1}))}toggle(){s.isConnected(this._menuNode)?this.hide():this.show()}static autoHide(t){const e=s.getDataset(t,"target"),i=s.find(".selectmenu-menu");for(const n of i){if(t&&s.hasDescendent(n,t))continue;const i=s.getDataset(n,"target");if(i===e)continue;const a=s.findOne(i);this.init(a).hide()}}static init(t,e,i=!1){return s.hasData(t,"selectmenu")?s.getData(t,"selectmenu"):new this(t,e,i)}}s.addEvent(a,"click.frost.selectmenu",t=>{r.autoHide(t.target)}),s.addEventDelegate(a,"click.frost.selectmenu",'[data-toggle="selectmenu"]',t=>{const e=n.getTarget(t.currentTarget);r.init(e).show()}),s.addEvent(a,"keyup.frost.selectmenu",t=>{switch(t.key){case"Tab":r.autoHide(t.target);break;case"Escape":r.autoHide()}}),Object.assign(r.prototype,{_updateSearchWidth(){const t=s.create("span",{text:s.getValue(this._searchInput),class:"d-inline-block",style:{fontSize:s.css(this._searchInput,"fontSize")}});s.append(a.body,t);const e=s.width(t);s.setStyle(this._searchInput,"width",e+2),s.remove(t)},_events(){s.addEvent(this._searchInput,"input",t=>{this._updateSearchWidth(),s.empty(this._itemsList),this._getData(t=>{this._renderResults(t.results)},{term:s.getValue(this._searchInput)})}),s.addEvent(this._toggle,"keydown",t=>{s.isConnected(this._searchInput)||(s.setValue(this._searchInput,""),s.append(this._toggle,this._searchInput),this._updateSearchWidth()),s.focus(this._searchInput)}),s.addEventDelegate(this._itemsList,"click","[data-action]",t=>{t.preventDefault();let e=s.getDataset(t.currentTarget,"value");this._multiple&&(e=this._value.concat([e])),this.setValue(e),this._settings.closeOnSelect&&this.hide()}),s.addEvent(this._toggle,"focus",t=>{s.focus(this._searchInput)}),s.addEventDelegate(this._toggle,"click","[data-action]",t=>{t.preventDefault();const e=s.parent(t.currentTarget),i=s.index(e);this._value.splice(i,1),this.setValue(this._value)})}}),Object.assign(r.prototype,{_findValue(t){for(const e of this._data){if(e.value==t)return e;if(e.children)for(const s of e.children)if(s.value==t)return s}return null},_refresh(){s.empty(this._node);const t=this._findValue(this._value);if(!t)return this._renderPlaceholder();s.append(this._node,t.element);const e=this._settings.renderSelection(t);s.setHTML(this._toggle,this._settings.sanitize(e))},_refreshMulti(){if(s.empty(this._node),s.empty(this._toggle),!this._value.length)return this._renderPlaceholder();for(const t of this._value){const e=this._findValue(t);if(!e)continue;s.append(this._node,e.element);const i=this._renderMultiSelection(e);s.append(this._toggle,i)}},_setValue(t){this._value=t,this._multiple?this._refreshMulti():this._refresh()}}),Object.assign(r.prototype,{_render(){this._multiple?this._renderSelectMulti():this._renderSelect(),this._renderMenu(),s.hide(this._node),s.after(this._node,this._toggle)},_renderItem(t){const e=s.create("li",{html:this._settings.sanitize(this._settings.renderResult(t)),class:"selectmenu-item",dataset:{action:"select",value:t.value}});return(this._multiple&&this._value.includes(t.value)||!this._multiple&&t.value==this._value)&&s.addClass(e,"active"),e},_renderGroup(t){return s.create("div",{html:this._settings.sanitize(this._settings.renderResult(t)),class:"selectmenu-group"})},_renderMenu(){if(this._menuNode=s.create("div",{class:"selectmenu-menu",dataset:{target:"#"+s.getAttribute(this._node,"id")}}),this._multiple)this._searchInput=s.create("input",{class:"selectmenu-multi-input"});else{const t=s.create("div",{class:"p-1"});s.append(this._menuNode,t),this._searchInput=s.create("input",{class:"input-filled"}),s.append(t,this._searchInput)}this._itemsList=s.create("ul",{class:"selectmenu-items"}),s.append(this._menuNode,this._itemsList),this._popper=new n.Popper(this._menuNode,{reference:this._toggle,placement:this._settings.placement,position:this._settings.position,fixed:this._settings.fixed,fullWidth:this._settings.fullWidth,spacing:this._settings.spacing,minContact:this._settings.minContact})},_renderMultiSelection(t){const e=s.create("div",{class:"btn-group"}),i=this._settings.renderSelection(t),n=s.create("div",{html:this._settings.sanitize(i),class:"btn btn-sm btn-secondary"});if(s.append(e,n),this._settings.allowClear){const t=s.create("div",{html:'<small class="icon-cancel"></small>',class:"btn btn-sm btn-outline-secondary",dataset:{action:"clear"}});s.append(e,t)}return e},_renderPlaceholder(){const t=s.create("span",{html:this._settings.sanitize(this._settings.placeholder),class:"selectmenu-placeholder"});s.append(this._toggle,t)},_renderResults(t){for(const e of t){const t=e.children?this._renderGroup(e):this._renderItem(e);s.append(this._itemsList,t)}},_renderSelectMulti(){this._toggle=s.create("button",{class:[s.getAttribute(this._node,"class"),"selectmenu-multi d-flex flex-wrap position-relative text-left"],dataset:{toggle:"selectmenu",target:"#"+s.getAttribute(this._node,"id")}})},_renderSelect(){this._toggle=s.create("button",{class:[s.getAttribute(this._node,"class"),"selectmenu-toggle position-relative text-left"],dataset:{toggle:"selectmenu",target:"#"+s.getAttribute(this._node,"id")}})}}),Object.assign(r.prototype,{data(){return this._multiple?this._value.map(t=>this._findValue(t)):this._findValue(this._value)},getValue(){return this._value},setValue(t){return this._multiple?this.setValueMulti(t):this._findValue(t)?this._setValue(t):void this._getData(e=>{if(this._findValue(t))return this._setValue(t)},{value:t})},setValueMulti(t){return t?t.every(t=>this._findValue(t))?this._setValue(t):void this._getData(e=>{if(t.every(t=>this._findValue(t)))return this._setValue(t)},{values:t}):this._setValue([])}}),Object.assign(r,{_buildOption:t=>s.create("option",{text:t.text,value:t.value}),_getDataFromDOM(t){const e=s.children(t),i=[];for(const t of e){const e=s.getText(t),n=s.getDataset(t);s.is(t,"option")?i.push({text:e,value:s.getValue(t),...n}):i.push({text:e,children:this._getDataFromDOM(t),...n})}return i},_getDataFromObject:t=>Object.entries(t).map(([t,e])=>({value:t,text:e})),_parseData(t){for(const e of t)e.children?this._parseData(e.children):e.element=this._buildOption(e);return t}}),r.defaults={data:null,maxSearch:0,maxSelect:0,minSearch:0,minResults:0,placeholder:"Nothing Selected",lang:{loadMore:"Loading..",maxSelect:"Selection limit reached.",noResults:"No results"},isMatch:(t,e)=>t.text.toLowerCase().indexOf(e.toLowerCase())>-1,renderResult:t=>t.text,renderSelection:t=>t.text,sanitize:t=>s.sanitize(t),sortResults:(t,e)=>t.sort((t,s)=>{const i=t.text.toLowerCase(),n=s.text.toLowerCase();if(e){const t=i.indexOf(e)-n.indexOf(e);if(t)return t}return i.localeCompare(n)}),allowClear:!1,closeOnSelect:!0,duration:100,placement:"bottom",position:"start",fixed:!1,fullWidth:!0,spacing:3,minContact:!1},i&&(i.prototype.selectmenu=function(t,...s){let i,n;e.isObject(t)?i=t:e.isString(t)&&(n=t);for(const t of this){if(!e.isElement(t))continue;const a=r.init(t,i);n&&a[n](...s)}return this}),n.SelectMenu=r}));