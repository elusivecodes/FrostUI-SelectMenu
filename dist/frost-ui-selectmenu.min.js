!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@fr0st/query"),require("@fr0st/ui")):"function"==typeof define&&define.amd?define(["exports","@fr0st/query","@fr0st/ui"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).UI=t.UI||{},t.fQuery,t.UI)}(this,(function(t,e,s){"use strict";class i extends s.BaseComponent{constructor(t,s){if(super(t,s),!e.is(this._node,"select"))throw new Error("SelectMenu must be created on a select element");let i,n;this._placeholderText=this._options.placeholder,this._maxSelections=this._options.maxSelections,this._multiple=e.getProperty(this._node,"multiple"),this._data=[],this._lookup={},this._activeItems=[],this._getData=null,e._isFunction(this._options.getResults)?this._getResultsInit():i=e._isPlainObject(this._options.data)?this._getDataFromObject(this._options.data):e._isArray(this._options.data)?this._options.data:this._getDataFromDOM(this._node),i&&(this._data=this._parseData(i),this._lookup=this._parseDataLookup(i),this._getDataInit()),n=this._multiple?[...this._node.selectedOptions].map((t=>e.getValue(t))):e.getValue(this._node),this._render(),this._loadValue(n),this._events()}disable(){e.setAttribute(this._node,{disabled:!0}),this._refreshDisabled()}dispose(){this._popper&&(this._popper.dispose(),this._popper=null),e.removeAttribute(this._node,"tabindex"),e.removeEvent(this._node,"focus.ui.selectmenu"),e.removeClass(this._node,this.constructor.classes.hide),e.remove(this._menuNode),e.remove(this._toggle),this._toggle=null,this._clear=null,this._searchInput=null,this._placeholder=null,this._menuNode=null,this._itemsList=null,this._data=null,this._lookup=null,this._activeItems=null,this._value=null,this._requests=null,this._popperOptions=null,this._getData=null,super.dispose()}enable(){e.removeAttribute(this._node,"disabled"),this._refreshDisabled()}hide(){e.isConnected(this._menuNode)&&!e.getDataset(this._menuNode,"uiAnimating")&&e.triggerOne(this._node,"hide.ui.selectmenu")&&(e.setDataset(this._menuNode,{uiAnimating:"out"}),this._refreshPlaceholder(),e.setValue(this._searchInput,""),e.fadeOut(this._menuNode,{duration:this._options.duration}).then((t=>{this._popper.dispose(),this._popper=null,this._activeItems=[],e.empty(this._itemsList),e.detach(this._menuNode),e.removeDataset(this._menuNode,"uiAnimating"),e.setAttribute(this._toggle,{"aria-expanded":!1,"aria-activedescendent":""}),e.setAttribute(this._searchInput,{"aria-activedescendent":""}),e.triggerEvent(this._node,"hidden.ui.selectmenu")})).catch((t=>{"out"===e.getDataset(this._menuNode,"uiAnimating")&&e.removeDataset(this._menuNode,"uiAnimating")})))}show(){if(e.is(this._node,":disabled")||e.isConnected(this._menuNode)||e.getDataset(this._menuNode,"uiAnimating")||!e.triggerOne(this._node,"show.ui.selectmenu"))return;const t=e.getValue(this._searchInput);this._getData({term:t}),e.setDataset(this._menuNode,{uiAnimating:"in"}),this._options.appendTo?e.append(this._options.appendTo,this._menuNode):e.after(this._toggle,this._menuNode),this._popper=new s.Popper(this._menuNode,this._popperOptions),e.fadeIn(this._menuNode,{duration:this._options.duration}).then((t=>{e.removeDataset(this._menuNode,"uiAnimating"),e.setAttribute(this._toggle,{"aria-expanded":!0}),e.triggerEvent(this._node,"shown.ui.selectmenu")})).catch((t=>{"in"===e.getDataset(this._menuNode,"uiAnimating")&&e.removeDataset(this._menuNode,"uiAnimating")}))}toggle(){return e.isConnected(this._menuNode)?this.hide():this.show()}update(){return this._popper&&this._popper.update(),this}}s.initComponent("selectmenu",i),i.defaults={placeholder:"",lang:{clear:"Remove selection",error:"Error loading data.",loading:"Loading..",maxSelections:"Selection limit reached.",noResults:"No results",search:"Search"},searchInputStyle:"filled",data:null,getResults:null,renderResult:t=>t.text,renderSelection:t=>t.text,sanitize:t=>e.sanitize(t),isMatch(t,s){const i=t.text,n=e._escapeRegExp(s),a=new RegExp(n,"i");if(a.test(i))return!0;const o=i.normalize("NFD").replace(/[\u0300-\u036f]/g,"");return a.test(o)},sortResults(t,e,s){const i=t.text.toLowerCase(),n=e.text.toLowerCase();if(s){const t=i.indexOf(s)-n.indexOf(s);if(t)return t}return i.localeCompare(n)},maxSelections:0,minSearch:0,allowClear:!1,closeOnSelect:!0,debounce:250,duration:100,maxHeight:"250px",appendTo:null,fullWidth:!1,placement:"bottom",position:"start",fixed:!1,spacing:0,minContact:!1},i.classes={active:"active",clear:"btn-close mx-2 lh-base",disabled:"disabled",disabledItem:"disabled",focus:"focus",group:"selectmenu-group",groupContainer:"selectmenu-group-container list-unstyled",hide:"visually-hidden",info:"selectmenu-item text-body-secondary",item:"selectmenu-item",items:"selectmenu-items list-unstyled",menu:"selectmenu-menu",menuSmall:"selectmenu-menu-sm",menuLarge:"selectmenu-menu-lg",multiClear:"btn d-flex",multiClearIcon:"btn-close p-0 my-auto pe-none",multiGroup:"btn-group my-n1",multiItem:"btn",multiSearchInput:"selectmenu-multi-input",multiToggle:"selectmenu-multi d-flex flex-wrap position-relative text-start",placeholder:"selectmenu-placeholder",searchContainer:"form-input",searchInputFilled:"input-filled",searchInputOutline:"input-outline",searchInputRipple:"ripple-line",searchOuter:"p-1",selectionSingle:"me-auto",toggle:"selectmenu-toggle d-flex position-relative justify-content-between text-start"};const n=i.prototype;n.data=function(){return this._multiple?this._value.map((t=>this._cloneItem(this._findValue(t)))):this._cloneItem(this._findValue(this._value))},n.getMaxSelections=function(){return this._maxSelections},n.getPlaceholder=function(){return this._placeholderText},n.getValue=function(){return this._value},n.setMaxSelections=function(t){this._maxSelections=t,this.hide(),this._refresh()},n.setPlaceholder=function(t){this._placeholderText=t,e.remove(this._placeholder),this._renderPlaceholder(),this._refresh()},n.setValue=function(t){this._loadValue(t)},n._buildOption=function(t){return e.create("option",{text:t.text,value:t.value,properties:{selected:!0}})},n._cloneItem=function(t){if(!t)return t;const{element:s,...i}=t;return e._extend({},i)},n._events=function(){e.addEvent(this._itemsList,"contextmenu.ui.selectmenu",(t=>{t.preventDefault()})),e.addEvent(this._menuNode,"mousedown.ui.selectmenu",(t=>{e.isSame(this._searchInput,t.target)||t.preventDefault()})),e.addEvent(this._menuNode,"click.ui.selectmenu",(t=>{t.stopPropagation()})),e.addEvent(this._node,"focus.ui.selectmenu",(t=>{e.isSame(this._node,document.activeElement)&&(this._multiple?e.focus(this._searchInput):e.focus(this._toggle))})),e.addEventDelegate(this._itemsList,"click.ui.selectmenu",'[data-ui-action="select"]',(t=>{t.preventDefault(),this._multiple&&e.setDataset(this._searchInput,{uiKeepFocus:!0});const s=e.getDataset(t.currentTarget,"uiValue");this._selectValue(s),this._multiple&&e.removeDataset(this._searchInput,"uiKeepFocus")})),e.addEventDelegate(this._itemsList,"mouseover.ui.selectmenu",'[data-ui-action="select"]',e.debounce((t=>{const s=e.findOne("[data-ui-focus]",this._itemsList);e.removeClass(s,this.constructor.classes.focus),e.removeDataset(s,"uiFocus"),e.addClass(t.currentTarget,this.constructor.classes.focus),e.setDataset(t.currentTarget,{uiFocus:!0});const i=e.getAttribute(t.currentTarget,"id");e.setAttribute(this._toggle,{"aria-activedescendent":i}),e.setAttribute(this._searchInput,{"aria-activedescendent":i})}))),e.addEvent(this._searchInput,"input.ui.selectmenu",e.debounce((t=>{if(this._multiple&&this._updateSearchWidth(),this._multiple&&!e.isConnected(this._menuNode))this.show();else{const t=e.getValue(this._searchInput);this._getData({term:t})}}))),e.addEvent(this._searchInput,"keydown.ui.selectmenu",(t=>{if("Backspace"===t.code){if(this._multiple&&this._value.length&&!e.getValue(this._searchInput)){t.preventDefault();const s=this._value.pop(),i=this._findValue(s).text;this._multiple&&e.setDataset(this._searchInput,{uiKeepFocus:!0}),this._refreshMulti(),e.setValue(this._searchInput,i),e.focus(this._searchInput),this._updateSearchWidth(),e.triggerEvent(this._searchInput,"input.ui.selectmenu"),this._multiple&&e.removeDataset(this._searchInput,"uiKeepFocus")}return}if(!["ArrowDown","ArrowUp","Enter","NumpadEnter"].includes(t.code))return;if(this._multiple&&!e.isConnected(this._menuNode))return void this.show();const s=e.findOne("[data-ui-focus]",this._itemsList);switch(t.code){case"Enter":case"NumpadEnter":if(s){const t=e.getDataset(s,"uiValue");this._selectValue(t)}return}let i;if(s){let e=this._activeItems.indexOf(s);switch(t.code){case"ArrowDown":e++;break;case"ArrowUp":e--}i=this._activeItems[e]}else i=this._activeItems[0];if(!i)return;e.removeClass(s,this.constructor.classes.focus),e.removeDataset(s,"uiFocus"),e.addClass(i,this.constructor.classes.focus),e.setDataset(i,{uiFocus:!0});const n=e.getAttribute(i,"id");e.setAttribute(this._toggle,{"aria-activedescendent":n}),e.setAttribute(this._searchInput,{"aria-activedescendent":n});const a=e.getScrollY(this._itemsList),o=e.rect(this._itemsList,{offset:!0}),l=e.rect(i,{offset:!0});l.top<o.top?e.setScrollY(this._itemsList,a+l.top-o.top):l.bottom>o.bottom&&e.setScrollY(this._itemsList,a+l.bottom-o.bottom)})),e.addEvent(this._searchInput,"keyup.ui.selectmenu",(t=>{"Escape"===t.code&&e.isConnected(this._menuNode)&&(t.stopPropagation(),this.hide(),this._multiple?(e.blur(this._searchInput),e.focus(this._searchInput)):e.focus(this._toggle))})),this._options.getResults&&e.addEvent(this._itemsList,"scroll.ui.selectmenu",e._throttle((t=>{if(this._request||!this._showMore)return;const s=e.height(this._itemsList),i=e.height(this._itemsList,{boxSize:e.SCROLL_BOX});if(e.getScrollY(this._itemsList)>=i-s-s/4){const t=e.getValue(this._searchInput),s=this._data.length;this._loadingScroll=!0,this._getData({term:t,offset:s})}}),250,{leading:!1})),this._multiple?this._eventsMulti():this._eventsSingle()},n._eventsMulti=function(){e.addEvent(this._searchInput,"focus.ui.selectmenu",(t=>{e.isSame(this._searchInput,document.activeElement)&&(e.hide(this._placeholder),e.detach(this._placeholder),e.addClass(this._toggle,"focus"))})),e.addEvent(this._searchInput,"blur.ui.selectmenu",(t=>{e.isConnected(this._searchInput)&&(e.isSame(this._searchInput,document.activeElement)||e.getDataset(this._searchInput,"uiKeepFocus")||(e.removeClass(this._toggle,"focus"),e.isConnected(this._menuNode)?"out"!==e.getDataset(this._menuNode,"uiAnimating")&&(e.stop(this._menuNode),e.removeDataset(this._menuNode,"uiAnimating"),this.hide()):this._refreshPlaceholder()))})),e.addEvent(this._toggle,"mousedown.ui.selectmenu",(t=>{e.is(t.target,'[data-ui-action="clear"]')?t.preventDefault():(e.hasClass(this._toggle,"focus")?e.setDataset(this._searchInput,{uiKeepFocus:!0}):(e.hide(this._placeholder),e.addClass(this._toggle,"focus")),e.addEventOnce(window,"mouseup.ui.selectmenu",(s=>{e.removeDataset(this._searchInput,"uiKeepFocus"),e.focus(this._searchInput),t.button||this.show()})))})),e.addEventDelegate(this._toggle,"click.ui.selectmenu",'[data-ui-action="clear"]',(t=>{if(t.button)return;t.stopPropagation();const s=e.parent(t.currentTarget),i=e.index(s),n=this._value.slice();n.splice(i,1),this._setValue(n,{triggerEvent:!0}),e.focus(this._searchInput)}))},n._eventsSingle=function(){e.addEvent(this._searchInput,"blur.ui.selectmenu",(t=>{e.isSame(this._searchInput,document.activeElement)||"out"!==e.getDataset(this._menuNode,"uiAnimating")&&(e.stop(this._menuNode),e.removeDataset(this._menuNode,"uiAnimating"),this.hide())})),e.addEvent(this._toggle,"mousedown.ui.selectmenu",(t=>{e.is(t.target,'[data-ui-action="clear"]')?t.preventDefault():t.button||(e.isConnected(this._menuNode)?this.hide():(this.show(),e.addEventOnce(window,"mouseup.ui.selectmenu",(t=>{e.focus(this._searchInput)}))))})),e.addEvent(this._toggle,"keydown.ui.selectmenu",(t=>{/^.$/u.test(t.key)&&(this.show(),e.focus(this._searchInput))})),this._options.allowClear&&e.addEventDelegate(this._toggle,"click.ui.selectmenu",'[data-ui-action="clear"]',(t=>{t.button||(t.stopPropagation(),this._setValue(null,{triggerEvent:!0}),e.isConnected(this._menuNode)&&this.hide())}))},n._findValue=function(t){return t in this._lookup?this._lookup[t]:null},n._getDataFromDOM=function(t){return e.children(t).map((t=>{const s=e.getDataset(t);return e.is(t,"option")?{text:e.getText(t),value:e.getValue(t),disabled:e.is(t,":disabled"),...s}:{text:e.getAttribute(t,"label"),children:this._getDataFromDOM(t),...s}}))},n._getDataFromObject=function(t){return Object.entries(t).map((([t,e])=>({value:t,text:e})))},n._getDataInit=function(){this._getData=({term:t=null})=>{if(this._activeItems=[],e.empty(this._itemsList),e.setAttribute(this._toggle,{"aria-activedescendent":""}),e.setAttribute(this._searchInput,{"aria-activedescendent":""}),this._options.minSearch&&(!t||t.length<this._options.minSearch))return this._multiple&&e.hide(this._menuNode),void this.update();if(e.show(this._menuNode),this._multiple&&this._maxSelections&&this._value.length>=this._maxSelections){const t=this._renderInfo(this._options.lang.maxSelections);return e.append(this._itemsList,t),void this.update()}let s=this._data;if(t){const i=this._options.isMatch.bind(this),n=this._options.sortResults.bind(this);s=this._data.flatMap((t=>"children"in t&&e._isArray(t.children)?t.children:t)).map((t=>this._cloneItem(t))).filter((e=>i(e,t))).sort(((e,s)=>n(e,s,t)))}this._renderResults(s),this.update()}},n._getResultsInit=function(){const t=e._debounce((({offset:t,term:s})=>{const i={offset:t};s&&(i.term=s);const n=Promise.resolve(this._options.getResults(i));n.then((s=>{const i=this._parseData(s.results);Object.assign(this._lookup,this._parseDataLookup(i)),this._request===n&&(t?(this._data.push(...i),e.detach(this._loader)):(this._data=i,e.empty(this._itemsList)),this._showMore=s.showMore,this._renderResults(i),this._request=null)})).catch((t=>{this._request===n&&(e.detach(this._loader),e.append(this._itemsList,this._error),this._request=null)})).finally((t=>{this._loadingScroll=!1,this.update()})),this._request=n}),this._options.debounce);this._getData=({offset:s=0,term:i=null})=>{if(this._request&&this._request.cancel&&this._request.cancel(),this._request=null,s)e.detach(this._error);else{this._activeItems=[],e.setAttribute(this._toggle,{"aria-activedescendent":""}),e.setAttribute(this._searchInput,{"aria-activedescendent":""});const t=e.children(this._itemsList,(t=>!e.isSame(t,this._loader)));e.detach(t)}if(this._options.minSearch&&(!i||i.length<this._options.minSearch))return this._multiple&&e.hide(this._menuNode),void this.update();if(e.show(this._menuNode),this._multiple&&this._maxSelections&&this._value.length>=this._maxSelections){const t=this._renderInfo(this._options.lang.maxSelections);return e.append(this._itemsList,t),void this.update()}const n=e.child(this._itemsList,":last-child");n&&e.isSame(n,this._loader)||e.append(this._itemsList,this._loader),this.update(),t({offset:s,term:i})}},n._loadValue=function(t){t&&this._options.getResults?(this._multiple?t.every((t=>this._findValue(t))):this._findValue(t))?this._setValue(t):Promise.resolve(this._options.getResults({value:t})).then((e=>{const s=this._parseData(e.results);Object.assign(this._lookup,this._parseDataLookup(s)),this._setValue(t)})).catch((t=>{})):this._setValue(t)},n._parseData=function(t){for(const s of t)"children"in s&&e._isArray(s.children)?this._parseData(s.children):s.element=this._buildOption(s);return t},n._parseDataLookup=function(t,s={}){for(const i of t)"children"in i?this._parseDataLookup(i.children,s):s[i.value]=e._extend({},i);return s},n._refresh=function(){this._multiple?this._refreshMulti():this._refreshSingle()},n._refreshDisabled=function(){const t=this._multiple?this._searchInput:this._toggle,s=e.is(this._node,":disabled");s?(e.addClass(this._toggle,this.constructor.classes.disabled),e.setAttribute(t,{tabindex:-1})):(e.removeClass(this._toggle,this.constructor.classes.disabled),e.removeAttribute(t,"tabindex")),e.setAttribute(this._toggle,{"aria-disabled":s})},n._refreshMulti=function(){this._value||(this._value=[]),this._value=this._value.filter((t=>{const e=this._findValue(t);return e&&!e.disabled})),this._value=e._unique(this._value),this._maxSelections&&this._value.length>this._maxSelections&&(this._value=this._value.slice(0,this._maxSelections)),e.detach(this._searchInput),e.empty(this._node),e.empty(this._toggle),this._refreshDisabled(),this._refreshPlaceholder();for(const t of this._value){const s=this._findValue(t);e.append(this._node,s.element);const i=this._renderMultiSelection(s);e.append(this._toggle,i)}e.append(this._toggle,this._searchInput)},n._refreshPlaceholder=function(){(this._multiple?this._value.length>0:this._value)?e.hide(this._placeholder):(e.show(this._placeholder),e.prepend(this._toggle,this._placeholder))},n._refreshSingle=function(){const t=this._findValue(this._value);if(t&&!t.disabled||(this._value=null),e.empty(this._node),e.empty(this._toggle),this._refreshDisabled(),this._refreshPlaceholder(),!this._value)return;e.append(this._node,t.element);const s=e.create("div",{class:this.constructor.classes.selectionSingle});e.append(this._toggle,s),this._options.allowClear&&e.append(this._toggle,this._clear);const i=this._cloneItem(t),n=this._options.renderSelection.bind(this)(i,s);e._isString(n)?e.setHTML(s,this._options.sanitize(n)):e._isElement(n)&&!e.isSame(tag,n)&&e.append(s,n)},n._render=function(){this._renderPlaceholder(),this._renderMenu(),this._multiple?this._renderToggleMulti():(this._options.allowClear&&this._renderClear(),this._renderToggleSingle()),this._options.getResults&&(this._loader=this._renderInfo(this._options.lang.loading),this._error=this._renderInfo(this._options.lang.error)),this._popperOptions={reference:this._toggle,placement:this._options.placement,position:this._options.position,fixed:this._options.fixed,spacing:this._options.spacing,minContact:this._options.minContact},this._options.fullWidth&&(this._popperOptions.beforeUpdate=t=>{e.setStyle(t,{width:""})},this._popperOptions.afterUpdate=(t,s)=>{const i=e.width(s,{boxSize:e.BORDER_BOX});e.setStyle(t,"width",`${i}px`)}),e.addClass(this._node,this.constructor.classes.hide),e.setAttribute(this._node,{tabindex:-1}),e.after(this._node,this._toggle)},n._renderClear=function(){this._clear=e.create("span",{class:this.constructor.classes.clear,attributes:{role:"button","aria-label":this._options.lang.clear},dataset:{uiAction:"clear"}})},n._renderGroup=function(t){const i=s.generateId("selectmenu-group"),n=e.create("li",{attributes:{id:i,role:"group","aria-label":t.text}}),a=e.create("div",{class:this.constructor.classes.group}),o=this._cloneItem(t),l=this._options.renderResult.bind(this)(o,a);e._isString(l)?e.setHTML(a,this._options.sanitize(l)):e._isElement(l)&&!e.isSame(a,l)&&e.append(a,l),e.append(n,a);const r=e.create("ul",{class:this.constructor.classes.groupContainer,attributes:{role:"none"}});e.append(n,r);for(const s of t.children){const t=this._renderItem(s,r);e.append(r,t)}return n},n._renderInfo=function(t){return e.create("li",{html:this._options.sanitize(t),class:this.constructor.classes.info})},n._renderItem=function(t){const i=s.generateId("selectmenu-item"),n=t.value,a=this._multiple?this._value.some((t=>t==n)):n==this._value,o=e.create("li",{class:this.constructor.classes.item,attributes:{id:i,role:"option","aria-label":t.text,"aria-selected":a}});t.disabled?(e.addClass(o,this.constructor.classes.disabledItem),e.setAttribute(o,{"aria-disabled":!0})):(this._activeItems.push(o),e.setDataset(o,{uiAction:"select",uiValue:n})),a&&(e.addClass(o,this.constructor.classes.active),e.setDataset(o,{uiActive:!0}));const l=this._cloneItem(t),r=this._options.renderResult.bind(this)(l,o);return e._isString(r)?e.setHTML(o,this._options.sanitize(r)):e._isElement(r)&&!e.isSame(o,r)&&e.append(o,r),o},n._renderMenu=function(){this._menuNode=e.create("div",{class:this.constructor.classes.menu}),e.is(this._node,".input-sm")?e.addClass(this._menuNode,this.constructor.classes.menuSmall):e.is(this._node,".input-lg")&&e.addClass(this._menuNode,this.constructor.classes.menuLarge);const t=s.generateId("selectmenu");if(!this._multiple){const s=e.create("div",{class:this.constructor.classes.searchOuter});e.append(this._menuNode,s);const i=e.create("div",{class:this.constructor.classes.searchContainer});if(e.append(s,i),this._searchInput=e.create("input",{class:"filled"===this._options.searchInputStyle?this.constructor.classes.searchInputFilled:this.constructor.classes.searchInputOutline,attributes:{role:"searchbox","aria-autocomplete":"list","aria-controls":t,"aria-activedescendent":"","aria-label":this._options.lang.search,autocomplete:"off"}}),e.append(i,this._searchInput),"filled"===this._options.searchInputStyle){const t=e.create("div",{class:this.constructor.classes.searchInputRipple});e.append(i,t)}}this._itemsList=e.create("ul",{class:this.constructor.classes.items,style:{maxHeight:this._options.maxHeight},attributes:{id:t,role:"listbox"}}),this._multiple&&e.setAttribute(this._itemsList,{"aria-multiselectable":!0}),e.append(this._menuNode,this._itemsList)},n._renderMultiSelection=function(t){const s=e.create("div",{class:this.constructor.classes.multiGroup}),i=e.create("div",{class:this.constructor.classes.multiClear,attributes:{role:"button","aria-label":this._options.lang.clear},dataset:{uiAction:"clear"}});e.append(s,i);const n=e.create("small",{class:this.constructor.classes.multiClearIcon});e.append(i,n);const a=e.create("div",{class:this.constructor.classes.multiItem}),o=this._cloneItem(t),l=this._options.renderSelection.bind(this)(o,a);return e._isString(l)?e.setHTML(a,this._options.sanitize(l)):e._isElement(l)&&!e.isSame(a,l)&&e.append(a,l),e.append(s,a),s},n._renderPlaceholder=function(){this._placeholder=e.create("span",{html:this._placeholderText?this._options.sanitize(this._placeholderText):"&nbsp;",class:this.constructor.classes.placeholder})},n._renderResults=function(t){for(const s of t){const t="children"in s&&e._isArray(s.children)?this._renderGroup(s):this._renderItem(s);e.append(this._itemsList,t)}if(!e.hasChildren(this._itemsList)){const t=this._renderInfo(this._options.lang.noResults);return e.append(this._itemsList,t),void this.update()}if(!e.findOne("[data-ui-focus]",this._itemsList)&&this._activeItems.length){const t=this._activeItems[0];e.addClass(t,this.constructor.classes.focus),e.setDataset(t,{uiFocus:!0});const s=e.getAttribute(t,"id");e.setAttribute(this._toggle,{"aria-activedescendent":s}),e.setAttribute(this._searchInput,{"aria-activedescendent":s})}},n._renderToggleMulti=function(){const t=e.getAttribute(this._itemsList,"id");this._toggle=e.create("div",{class:[e.getAttribute(this._node,"class")||"",this.constructor.classes.multiToggle],attributes:{role:"combobox","aria-haspopup":"listbox","aria-expanded":!1,"aria-disabled":!1,"aria-controls":t,"aria-activedescendent":""}}),this._searchInput=e.create("input",{class:this.constructor.classes.multiSearchInput,attributes:{role:"searchbox","aria-autocomplete":"list","aria-label":this._options.lang.search,"aria-describedby":t,"aria-activedescendent":"",autocomplete:"off"}})},n._renderToggleSingle=function(){const t=e.getAttribute(this._itemsList,"id");this._toggle=e.create("button",{class:[e.getAttribute(this._node,"class")||"",this.constructor.classes.toggle],attributes:{type:"button",role:"combobox","aria-haspopup":"listbox","aria-expanded":!1,"aria-disabled":!1,"aria-controls":t,"aria-activedescendent":""}})},n._selectValue=function(t){const s=this._findValue(t);if(s){if(t=s.value,this._multiple){const e=this._value.findIndex((e=>e==t));e>=0?(t=this._value.slice()).splice(e,1):t=this._value.concat([t])}this._setValue(t,{triggerEvent:!0}),this._refreshPlaceholder(),e.setValue(this._searchInput,""),this._options.closeOnSelect?this.hide():this._getData({}),this._multiple?e.focus(this._searchInput):e.focus(this._toggle)}},n._setValue=function(t,{triggerEvent:s=!1}={}){let i;i=this._multiple?!this._value||t.length!==this._value.length||t.some(((t,e)=>t!==this._value[e])):t!==this._value,i&&(this._value=t,this._refresh(),s&&e.triggerEvent(this._node,"change.ui.selectmenu"))},n._updateSearchWidth=function(){const t=e.create("span",{text:e.getValue(this._searchInput),style:{display:"inline-block",fontSize:e.css(this._searchInput,"fontSize"),whiteSpace:"pre-wrap"}});e.append(document.body,t);const s=e.width(t);e.setStyle(this._searchInput,{width:s+2}),e.remove(t)},t.SelectMenu=i}));